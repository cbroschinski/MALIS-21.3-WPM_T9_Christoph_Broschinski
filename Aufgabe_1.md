# Beschreibung von datenintensiven und datenfokusierten Aktivitäten im eigenen Arbeitsalltag

In meinem Arbeitsalltag bin ich vor allem für das [OpenAPC-Projekt](https://github.com/OpenAPC/openapc-de) tätig, das Daten zum kostenpflichtigen Open Access-Publizieren sammelt, aufbereitet und veröffentlicht. Das gesamte Projekt ist dabei naturgemäß enorm datenintensiv: Die von unseren Teilnehmern bereitgestellten Beiträge (alle Einreichungen zu OpenAPC geschehen auf freiwilliger Basis) müssen entgegengenommen, formatiert, angereichert, überprüft und dann strukturiert in unserem Repository abgelegt werden. Im Folgenden soll dieser Workflow näher erläutert werden.

## Datenverarbeitung in OpenAPC

Teilnehmende Einrichtungen (dabei kann es sich um einzelne Hochschulen und Forschungsinstitute oder auch zentrale Einrichtungen wie Nationalbibliotheken handeln) können neue Daten entweder per Mail oder direkt als [Pull Request](https://github.com/OpenAPC/openapc-de/pulls) einreichen. [Diese Datei](https://raw.githubusercontent.com/OpenAPC/openapc-de/master/data/unileipzig/OpenAPC_LeipzigU_Gold_2020.csv) zeigt beispielsweise einen Beitrag der Universität Leipzig mit gezahlten APCs für das Jahr 2020.
Die Tabelle enthält dabei lediglich 5 Spalten (Pflichtfelder), das Zielformat unseren Datensatzes für Zeitschriftenartikel besteht allerdings aus [18 Spalten](https://github.com/OpenAPC/openapc-de/wiki/schema#mandatory-and-backup-columns). Die fehlenden Daten reichern wir automatisch aus mehreren externen Quellen an: So beziehen wir den Titel und Verlag der Zeitschrift beispielsweise aus [Crossref](https://www.crossref.org/) - wichtig, um konsistente Ansetzungen zu erzeugen. Weitere Provider für Metadaten, die wir verwenden, sind Pubmed Central, das DOAJ, das Web of Science sowie die ISSN-Organisation. Seit einiger Zeit werden außerdem Kostendaten für Open Access-Bücher gesammelt, hier kommt als Datenquelle noch das DOAB (Directory of Open Access Books) hinzu.
Die Anreicherung geschieht dabei im Wesentlichen automatisch: Ein [Python-Skript](https://github.com/OpenAPC/openapc-de/blob/master/python/apc_csv_processing.py) wird aus der Shell aufgerufen und enthält den Pfad zur Ausgangsdatei als Argument. Die CSV-Tabelle wird dann zeilenweise durchlaufen und verarbeitet, zum Schluss wird eine angereicherte Variante generiert, die üblicherweise durch das Suffix `_enriched` im Dateinamen gekennzeichnet wird - [hier](https://github.com/OpenAPC/openapc-de/blob/master/data/unileipzig/OpenAPC_LeipzigU_Gold_2020_enriched.csv) etwa das angereicherte Äquivalent zur oben erwähnten Beispieldatei aus Leipzig. Alle angereicherten Dateien zusammen bilden schließlich den OpenAPC-Datensatz [für Zeitschriftenartikel](https://github.com/OpenAPC/openapc-de/blob/master/data/apc_de.csv) bzw. denjenigen für [OA-Bücher](https://github.com/OpenAPC/openapc-de/blob/master/data/bpc.csv). Die folgende Grafik zeigt den Vorgang als Ablaufdiagramm:

![](https://www.ub.uni-bielefeld.de/~cbroschinski/presentations/slidy/graphics/openapc_enrichment_overview_v2.svg)

Das Anreicherungsskript ist dabei im Laufe der Jahre immer wieder verbessert und erweitert worden, um weitere Randfälle und Probleme, die während einer Datenanreicherung vorkommen können, möglichst automatisch beheben zu können. Viele Funktionen sind dabei in ein eigenes Modul [ausgelagert](https://github.com/OpenAPC/openapc-de/blob/master/python/openapc_toolkit.py), teilweise werden diese durch andere Skripte genutzt, die ebenfalls im [python](https://github.com/OpenAPC/openapc-de/tree/master/python)-Verzeichnis zu finden sind. Eine komplette Beschreibung dieser Softwarelandschaft würde hier sicherlich den Rahmen sprengen, daher sollen hier nur einige interessante Fälle exemplarisch aufgelistet werden:

### Automatisches Zuordnen von Tabellenspalten

Gemäß unserer Vorgaben sollten eingereichte Tabellen ein bestimmtes wohldefiniertes Format haben. Die oben verlinkte [Beispieldatei](https://raw.githubusercontent.com/OpenAPC/openapc-de/master/data/unileipzig/OpenAPC_LeipzigU_Gold_2020.csv) aus Leipzig erfüllt diese Anforderungen: Es gibt die 5 Pflichtspalten `institution`, `period`, `euro`, `doi` und `is_hybrid`. Das ist allerdings in der Praxis längst nicht immer der Fall: Viele eingereichte Tabellen enthalten andere Spaltennamen, die Reihenfolge ist vertauscht oder es gibt zusätzliche Spalten mit Daten, die für OpenAPC nicht relevant sind. Um eine zeitaufwändige Vorverarbeitung zu vermeiden, kann das Anreicherungsskript solche Inkonsistenzen selbst auflösen: Spaltennamen können zunächst automatisiert über eine [Lookup-Tabelle](https://github.com/OpenAPC/openapc-de/blob/master/python/mappings.py#L407) bzw. Whitelist zugeordnet werden. Falls das scheitert, beherrscht das Skript auch eine heuristische Analyse: Der Inhalt einiger Felder einer unbekannten Spalte wird analysiert, um den Inhaltstyp zu bestimmen, was beispielsweise für Jahreszahlen, Euro-Beträge und DOIs gut funktioniert. In letzter Instanz ist immer noch möglich, fehlende Spalteninformationen als Aurufparameter zuzuweisen: `python apc_csv_processing.py dateiname.csv -euro 2` übergibt dem Skript beispielsweise die Information, dass es sich bei der 2. Splate von links (ab 0 gezählt) um die `euro`-Spalte handelt.

### Normalisierung während der Anreicherung

Viele Metadaten, die entweder schon in den eingereichten Tabellen enthalten sind oder während der Anreicherung hinzugefügt werden, sind nicht normiert und müssen vereinheitlicht werden, um Inkonsistenzen im OpenAPC-Datensatz zu vermeiden. Auch dieser Prozess geschieht automatisch:

- Institutionsnamen: OpenAPC verwendet aus historischen Gründen keine Vorgaben für die Namen von Einrichtungen und überlässt diesen in der Regel die Schreibweise. Um trotzdem konsistente Datenhaltung zu betreiben, gibt es eine gesonderte [Tabelle](https://github.com/OpenAPC/openapc-de/blob/master/data/institutions.csv), in der Metadaten zu teilnehmenden Institutionen vorgehalten werden, hier gibt es beispielsweise auch Verweise auf Instituions-PIDs wie etwa GRID oder ROR. Diese Tabelle wird während der Anreicherung auch zur Normalisierung verwendet, indem aus dem Verzeichnis, in dem die anzureichernde Datei liegt (`openapc_data_dir`), auf die zu verwendende Bezeichnung (`institution`) geschlossen wird.
- DOIs: Obwohl eine DOI ein persistenter Identifier ist, gibt es Unterschiede bei der Schreibweise: So ist Groß- und Kleinschreibung irrelevant, die DOI kann in Reinform, als URI mit vorangestelltem Resolver-Link (`https://doi.org/`) oder als "Handbook"-Variante (`doi:`) dargestellt werden. OpenAPC verwendet grundsätzlich die kleingeschriebene Variante in Reinform und normalisiert alle DOIs entsprechend, hierfür gibt es eine eigene [Python-Funktion](https://github.com/OpenAPC/openapc-de/blob/v4.52.4-0-0/python/openapc_toolkit.py#L741). Dies ist beispielsweise für die Dublettenerkennung wichtig.




